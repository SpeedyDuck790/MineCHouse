.ORIG X3000
AND R0,R0,#0
AND R1,R1,#0
AND R2,R2,#0
AND R3,R3,#0
AND R4,R4,#0
AND R5,R5,#0
AND R6,R6,#0
TRAP 0x31
ADD R2,R2,#10 ;ready state
ST R0, XCOORD
ST R1, YCOORD
ST R2, ZCOORD

LD R3,BLOCKWALL
LD R5,LENGTH
JSR WALL1
LD R5,LENGTH
JSR WALL2
LD R5,LENGTH
JSR WALL3
LD R5,LENGTH
JSR WALLD
LD R3,BLOCKFLOOR
LD R5,LENGTHF
JSR FLOOR
TRAP 0x36

JSR BEDT
ADD R1,R1,#5
LD R5,LENGTHF
LD R3,ROOF
JSR FLOOR
JSR DOORWIN
HALT
HEIGHT .FILL #10
LENGTH .FILL #10
HEIGHTF .FILL #11
LENGTHF .FILL #11
BLOCKWALL .FILL #5
BLOCKFLOOR .FILL #1
SPARERET .FILL #0
XCOORD .FILL #0
YCOORD .FILL #0
ZCOORD .FILL #0
DOOR .FILL #64
AIR .FILL #0
GLASS .FILL #20
BED .FILL #26
TORCHY .FILL #50
ROOF .FILL #98

BEDT LD R3,BED
ADD R1,R1,#1
ADD R2,R2,#5
ADD R0,R0,#1
TRAP 0x34
LD R3,TORCHY
ADD R1,R1,#4
TRAP 0x34
ADD R2,R2,#-5
ADD R0,R0,#-1
RET

DOORWIN LD R0, XCOORD
LD R1, YCOORD
LD R2, ZCOORD
ADD R0,R0,#5
ADD R1,R1,#1
LD R3,AIR
TRAP 0x34
ADD R1,R1,#1
TRAP 0x34
LD R3,DOOR
ADD R1,R1,#-1
TRAP 0x34
ST R7, SPARERET
JSR WIN
LD R7,SPARERET
RET

WIN ADD R1,R1,#5
LD R3,GLASS
TRAP 0x34
ADD R1,R1,#1
TRAP 0x34
ADD R1,R1,#1
TRAP 0x34
ADD R1,R1,#-1
ADD R0,R0,#-1
TRAP 0x34
ADD R0,R0,#2
TRAP 0x34
RET

WALL1 LD R4, HEIGHT 
ADD R0,R0,#1
ST R7, SPARERET
JSR TOWER
LD R7,SPARERET
ADD R5,R5,#-1
BRp WALL1
RET

WALL2 LD R4, HEIGHT 
ADD R2,R2,#1
ST R7,SPARERET
JSR TOWER
LD R7,SPARERET
ADD R5,R5,#-1
BRp WALL2
RET

WALL3 LD R4, HEIGHT 
ADD R0,R0,#-1
ST R7,SPARERET
JSR TOWER
LD R7,SPARERET
ADD R5,R5,#-1
BRp WALL3
RET

WALLD LD R4, HEIGHT 
ADD R2,R2,#-1
ST R7,SPARERET
JSR TOWER
LD R7,SPARERET
ADD R5,R5,#-1
BRp WALLD
RET


TOWER TRAP 0x34
ADD R1,R1,#1
ADD R4,R4,#-1
BRp TOWER
ADD R1, R1,#-10
RET

FLOOR LD R4, HEIGHTF
ST R7,SPARERET
JSR AXIS
LD R7,SPARERET
ADD R0,R0,#1
ADD R5,R5,#-1
BRp FLOOR
ADD R0, R0,#-11
RET

AXIS TRAP 0x34
ADD R2,R2,#1
ADD R4,R4,#-1
BRp AXIS
ADD R2,R2,#-11
RET
.END